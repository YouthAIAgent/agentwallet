<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgentWallet Protocol | Real dApp on Solana</title>
  <meta name="description" content="Create PDA wallets on Solana devnet. Real on-chain transactions. Wallet-connected dApp.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #0a0a0a;
      --bg-secondary: #111111;
      --green: #00ff41;
      --cyan: #00d4ff;
      --red: #ff0040;
      --yellow: #ffcc00;
      --purple: #a855f7;
      --text: #c0c0c0;
      --text-dim: #666;
      --border: #1a1a1a;
    }
    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }
    ::selection { background: rgba(0, 255, 65, 0.3); }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 40px;
    }
    .logo {
      font-size: 24px;
      font-weight: 800;
      letter-spacing: 4px;
      background: linear-gradient(90deg, var(--green), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .badge {
      font-size: 10px;
      padding: 4px 12px;
      border: 1px solid var(--green);
      color: var(--green);
      letter-spacing: 2px;
    }
    .wallet-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 30px;
      margin-bottom: 30px;
    }
    .section-title {
      font-size: 14px;
      color: var(--green);
      letter-spacing: 2px;
      margin-bottom: 20px;
    }
    .wallet-btn {
      background: transparent;
      border: 1px solid var(--green);
      color: var(--green);
      padding: 12px 24px;
      font-family: inherit;
      font-size: 12px;
      letter-spacing: 2px;
      cursor: pointer;
    }
    .wallet-btn:hover {
      background: rgba(0, 255, 65, 0.1);
    }
    .terminal {
      background: #000;
      border: 1px solid var(--border);
      padding: 20px;
      min-height: 200px;
      font-size: 12px;
      font-family: monospace;
    }
    .terminal-line { margin: 4px 0; }
    .terminal-line.success { color: var(--green); }
    .terminal-line.error { color: var(--red); }
    .terminal-line.info { color: var(--cyan); }
    .action-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .action-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 24px;
    }
    .action-card h3 {
      font-size: 14px;
      color: var(--cyan);
      margin-bottom: 16px;
    }
    .btn {
      background: transparent;
      border: 1px solid var(--cyan);
      color: var(--cyan);
      padding: 10px 20px;
      font-family: inherit;
      font-size: 11px;
      cursor: pointer;
    }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn.green { border-color: var(--green); color: var(--green); }
    footer {
      margin-top: 60px;
      padding: 30px 0;
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: 11px;
      color: var(--text-dim);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">AGENTWALLET_PROTOCOL</div>
      <div class="badge">v2.0 // REAL DAPP</div>
    </header>
    
    <div class="wallet-section">
      <div class="section-title">WALLET CONNECTION</div>
      <button id="connect-btn" class="wallet-btn">Connect Phantom Wallet</button>
      <div id="wallet-info" style="display:none; margin-top:20px;">
        <p>Connected: <span id="wallet-address"></span></p>
        <p>Balance: <span id="wallet-balance">0</span> SOL</p>
        <button id="disconnect-btn" class="btn" style="margin-top:10px;">Disconnect</button>
      </div>
    </div>
    
    <div class="wallet-section">
      <div class="section-title">SYSTEM LOG</div>
      <div id="terminal" class="terminal">
        <div class="terminal-line info">[INFO] AgentWallet Protocol v2.0 initialized</div>
        <div class="terminal-line info">[INFO] Network: Solana Devnet</div>
        <div class="terminal-line info">[INFO] Waiting for wallet connection...</div>
      </div>
    </div>
    
    <div class="action-grid">
      <div class="action-card">
        <h3>DEVNET FAUCET</h3>
        <p style="font-size:12px; color:var(--text-dim); margin-bottom:16px;">Request 2 SOL from devnet faucet</p>
        <button id="faucet-btn" class="btn green" disabled>Request Airdrop</button>
      </div>
      
      <div class="action-card">
        <h3>SEND SOL</h3>
        <input type="text" id="send-to" placeholder="Recipient address" style="width:100%; background:#000; border:1px solid var(--border); color:var(--text); padding:10px; margin-bottom:10px; font-family:inherit;">
        <input type="number" id="send-amount" value="0.1" step="0.001" style="width:100%; background:#000; border:1px solid var(--border); color:var(--text); padding:10px; margin-bottom:10px; font-family:inherit;">
        <button id="send-btn" class="btn green" disabled>Send SOL</button>
      </div>
    </div>
    
    <footer>
      <p>Program ID: CEQLGCWkpUjbsh5kZujTaCkFB59EKxmnhsqydDzpt6r6</p>
      <p>Real on-chain transactions. No backend. Wallet-only.</p>
    </footer>
  </div>

  <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
  <script>
    const CONFIG = {
      NETWORK: 'devnet',
      RPC_URL: 'https://api.devnet.solana.com',
      PROGRAM_ID: 'CEQLGCWkpUjbsh5kZujTaCkFB59EKxmnhsqydDzpt6r6'
    };
    
    let connection = new solanaWeb3.Connection(CONFIG.RPC_URL, 'confirmed');
    let wallet = null;
    
    const terminal = document.getElementById('terminal');
    const connectBtn = document.getElementById('connect-btn');
    const disconnectBtn = document.getElementById('disconnect-btn');
    const walletInfo = document.getElementById('wallet-info');
    const walletAddress = document.getElementById('wallet-address');
    const walletBalance = document.getElementById('wallet-balance');
    
    function log(msg, type='info') {
      const line = document.createElement('div');
      line.className = 'terminal-line ' + type;
      line.textContent = `[${type.toUpperCase()}] ${msg}`;
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;
    }
    
    async function connectWallet() {
      try {
        if (!window.solana || !window.solana.isPhantom) {
          alert('Please install Phantom wallet');
          return;
        }
        
        const resp = await window.solana.connect();
        wallet = resp;
        
        connectBtn.style.display = 'none';
        walletInfo.style.display = 'block';
        walletAddress.textContent = wallet.publicKey.toString().slice(0,6) + '...' + wallet.publicKey.toString().slice(-4);
        
        document.getElementById('faucet-btn').disabled = false;
        document.getElementById('send-btn').disabled = false;
        
        log('Wallet connected: ' + wallet.publicKey.toString(), 'success');
        updateBalance();
        
      } catch (err) {
        log('Connection failed: ' + err.message, 'error');
      }
    }
    
    async function disconnectWallet() {
      await window.solana.disconnect();
      wallet = null;
      connectBtn.style.display = 'block';
      walletInfo.style.display = 'none';
      document.getElementById('faucet-btn').disabled = true;
      document.getElementById('send-btn').disabled = true;
      log('Wallet disconnected', 'info');
    }
    
    async function updateBalance() {
      if (!wallet) return;
      const balance = await connection.getBalance(wallet.publicKey);
      walletBalance.textContent = (balance / solanaWeb3.LAMPORTS_PER_SOL).toFixed(4);
    }
    
    async function requestAirdrop() {
      if (!wallet) return;
      try {
        log('Requesting 2 SOL airdrop...', 'info');
        document.getElementById('faucet-btn').disabled = true;
        
        const sig = await connection.requestAirdrop(wallet.publicKey, 2 * solanaWeb3.LAMPORTS_PER_SOL);
        await connection.confirmTransaction(sig, 'confirmed');
        
        log('Airdrop confirmed! 2 SOL received', 'success');
        updateBalance();
      } catch (err) {
        log('Airdrop failed: ' + err.message, 'error');
      } finally {
        document.getElementById('faucet-btn').disabled = false;
      }
    }
    
    // Validate Solana address format
    function isValidSolanaAddress(address) {
      try {
        if (!address || address.length < 32 || address.length > 44) return false;
        const pubkey = new solanaWeb3.PublicKey(address);
        return solanaWeb3.PublicKey.isOnCurve(pubkey.toBytes());
      } catch {
        return false;
      }
    }
    
    async function sendSOL() {
      if (!wallet) {
        log('Please connect wallet first', 'error');
        return;
      }
      
      const to = document.getElementById('send-to').value.trim();
      const amount = parseFloat(document.getElementById('send-amount').value);
      
      // Validate inputs
      if (!to) {
        log('Error: Please enter recipient address', 'error');
        return;
      }
      
      if (!isValidSolanaAddress(to)) {
        log('Error: Invalid Solana address format', 'error');
        return;
      }
      
      if (!amount || amount <= 0) {
        log('Error: Amount must be greater than 0', 'error');
        return;
      }
      
      // Check balance before sending
      try {
        const balance = await connection.getBalance(wallet.publicKey);
        const balanceSOL = balance / solanaWeb3.LAMPORTS_PER_SOL;
        const required = amount + 0.005; // Amount + estimated fee
        
        if (balanceSOL < required) {
          log(`Error: Insufficient balance. Have: ${balanceSOL.toFixed(4)} SOL, Need: ${required.toFixed(4)} SOL`, 'error');
          return;
        }
        
        log(`Sending ${amount} SOL to ${to.slice(0,6)}...${to.slice(-4)}`, 'info');
        document.getElementById('send-btn').disabled = true;
        
        const tx = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: wallet.publicKey,
            toPubkey: new solanaWeb3.PublicKey(to),
            lamports: amount * solanaWeb3.LAMPORTS_PER_SOL
          })
        );
        
        const { signature } = await window.solana.signAndSendTransaction(tx);
        await connection.confirmTransaction(signature, 'confirmed');
        
        log('Transaction confirmed! Sig: ' + signature.slice(0,16) + '...', 'success');
        updateBalance();
      } catch (err) {
        log('Transaction failed: ' + err.message, 'error');
      } finally {
        document.getElementById('send-btn').disabled = false;
      }
    }
    
    connectBtn.addEventListener('click', connectWallet);
    disconnectBtn.addEventListener('click', disconnectWallet);
    document.getElementById('faucet-btn').addEventListener('click', requestAirdrop);
    document.getElementById('send-btn').addEventListener('click', sendSOL);
    
    // Auto-check for Phantom on load
    if (window.solana && window.solana.isPhantom) {
      log('Phantom wallet detected - ready to connect', 'info');
    } else {
      log('Phantom wallet not detected. Please install from phantom.app', 'error');
    }
  </script>
</body>
</html>